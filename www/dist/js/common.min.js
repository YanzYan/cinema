var app=angular.module("starter",["ionic"]);app.run(["$ionicPlatform",function(o){o.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]);
app.config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(t,e,l){l.backButton.text("返回"),l.backButton.previousTitleText(!1),l.platform.android.tabs.position("bottom"),l.platform.android.navBar.alignTitle("center"),t.state("tab",{url:"/tab",abstract:!0,templateUrl:"templates/tabs.html"}).state("tab.film",{url:"/film",views:{"tab-film":{templateUrl:"templates/tab-film.html",controller:"FilmCtrl"}}}).state("tab.film-detail",{url:"/film-detail?id",views:{"tab-film":{templateUrl:"templates/film-detail.html",controller:"FilmDetailCtrl"}}}).state("tab.film-search",{url:"/film-search",views:{"tab-film":{templateUrl:"templates/film-search.html",controller:"FilmSearchCtrl"}}}).state("tab.cinema-search",{url:"/cinema-search",views:{"tab-cinema":{templateUrl:"templates/cinema-search.html",controller:"CinemaSearchCtrl"}}}).state("tab.cinema",{url:"/cinema",views:{"tab-cinema":{templateUrl:"templates/tab-cinema.html",controller:"CinemaCtrl"}}}).state("tab.film-list",{url:"/film-list?coming",views:{"tab-film":{templateUrl:"templates/film-list.html",controller:"FilmListCtrl"}}}).state("tab.mine",{url:"/mine",views:{"tab-mine":{templateUrl:"templates/tab-mine.html",controller:"MineCtrl"}}}).state("cinema-detail",{url:"/cinema-detail?cinemaId",templateUrl:"templates/cinema-detail.html",controller:"CinemaDetailCtrl"}).state("buy-ticket",{url:"/buy-ticket",templateUrl:"templates/buy-ticket.html",controller:"BuyTicketCtrl"}),e.otherwise("/tab/film")}]);

app.controller("TabsCtrl",["$rootScope","$state",function(t,e){t.$on("$ionicView.beforeEnter",function(){t.hideTabs=!1,"tab.film"!=e.current.name&&"tab.cinema"!=e.current.name&&"tab.mine"!=e.current.name&&(t.hideTabs=!0)})}]).controller("FilmCtrl",["$scope","$state","$http","$ionicLoading",function(t,e,o,i){function n(){o.get("https://m.maoyan.com/movie/list.json?type=hot&offset=0&limit=3").success(function(e){t.hot=e.data.movies}),o.get("https://m.maoyan.com/movie/list.json?type=coming&offset=0&limit=4").success(function(e){t.coming=e.data.movies,i.hide()}).error(function(t){i.hide(),alert(t)}),o.get("https://m.maoyan.com/cinemas.json").success(function(e){t.data=e.data})}function a(){$.getScript("http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=js",function(e){"1"==remote_ip_info.ret?t.addr=remote_ip_info.city:alert("没有找到匹配的IP地址信息！")})}!function(){i.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner>'}),n()}(),a(),t.getLocation=function(){a(),alert("您所在的区域是"+t.addr)},t.goFilmDetail=function(t){e.go("tab.film-detail",{id:t})},t.goFilmList=function(t){e.go("tab.film-list",{coming:t})},t.goCinemaDetail=function(t){e.go("cinema-detail",{cinemaId:t})},t.goFilmSearch=function(){e.go("tab.film-search")}}]).controller("CinemaCtrl",["$scope","$state","$ionicSlideBoxDelegate","$http",function(t,e,o,i){t.selectedSite=0,i.get("https://m.maoyan.com/cinemas.json").success(function(e){t.data=e.data}),t.goCinemaDetail=function(t){e.go("cinema-detail",{cinemaId:t})}}]).controller("FilmDetailCtrl",["$scope","$http","$state","$ionicViewSwitcher","$stateParams","$ionicLoading","$sce",function(t,e,o,i,n,a,c){function s(){t.id=n.id,console.log(n.id),t.url="http://m.maoyan.com/movie/"+t.id+".json",e.get(t.url).success(function(e){t.filmData=e.data.MovieDetailModel,console.log(t.filmData),console.log(t.filmData.dra),a.hide()}).error(function(t){a.hide(),alert(t)})}t.goBuyTicket=function(t){o.go("buy-ticket",{id:t}),i.nextDirection("forwoard")},function(){a.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner>'}),s()}()}]).controller("BuyTicketCtrl",["$scope","$ionicViewSwitcher","$stateParams",function(t,e,o){e.nextDirection("forwoard"),t.id=o.id,console.log(t.id)}]).controller("CinemaDetailCtrl",["$scope","$state","$stateParams","$ionicSlideBoxDelegate","$http",function(t,e,o,i,n){t.slideIndex=0,t.slideChanged=function(e){t.slideIndex=e,0==t.slideIndex?console.log("slide 0"):1==t.slideIndex?console.log("slide 1"):2==t.slideIndex?console.log("slide 2"):3==t.slideIndex&&console.log("slide 3")},t.activeSlide=function(t){i.slide(t)},t.cinemaId=o.cinemaId,t.url="https://m.maoyan.com/showtime/wrap.json?cinemaid="+t.cinemaId+"&movieid=",n.get(t.url).success(function(e){console.log(e.data),t.cinema=e.data,t.date=e.data.Dates,t.movies=e.data.movies,t.keys=[],t.value=[],t.movieValue=[];for(var o in t.date)t.keys.push(o),t.value.push(t.date[o]);for(var o in t.movies)t.movieValue.push(t.movies[o])}).error(function(t){}),t.choose=function(){t.chooseclass=!0}}]).controller("FilmListCtrl",["$scope","$state","$ionicSlideBoxDelegate","$http","$stateParams",function(t,e,o,i,n){function a(){i.get("https://m.maoyan.com/movie/list.json?type=hot&offset=0&limit=1000").success(function(e){t.hot=e.data.movies}),i.get("https://m.maoyan.com/movie/list.json?type=coming&offset=0&limit=1000").success(function(e){t.coming=e.data.movies}).error(function(t){})}t.$on("$ionicView.enter",function(t){a()}),console.log(n.coming),void 0!=n.coming?(t.hotClass=!1,t.comingClass=!0):(t.hotClass=!0,t.comingClass=!1),t.activeSlide=function(e){o.slide(e),0==e?(t.hotClass=!0,t.comingClass=!1):1==e&&(t.hotClass=!1,t.comingClass=!0)},t.goDetail=function(t){e.go("tab.film-detail",{id:t})}}]).controller("MineCtrl",["$scope",function(t){}]).controller("FilmSearchCtrl",["$scope","$http","$state",function(t,e,o){t.hot=[],function(){e.get("https://m.maoyan.com/movie/list.json?type=hot&offset=0&limit=1000").success(function(e){t.hot=e.data.movies}),e.get("https://m.maoyan.com/movie/list.json?type=coming&offset=0&limit=1000").success(function(e){t.coming=e.data.movies,t.all=t.hot.concat(t.coming)})}(),t.searchCont={},t.ItemArr2=[],t.search=function(){t.box=!1,t.ItemArr2=[];for(var e=0;e<t.all.length;e++){var o=e;t.all[o].nm.indexOf(t.searchCont.key)>=0&&t.ItemArr2.push(t.all[o])}""==t.ItemArr2&&(t.box=!0,t.ItemArr2=[])},t.goDetail=function(t){o.go("tab.film-detail",{id:t})},t.clearSearch=function(){alert(111),t.searchName="",console.log(t.searchName),t.ItemArr2=[]}}]).controller("CinemaSearchCtrl",["$scope","$http","$state",function(t,e,o){e.get("https://m.maoyan.com/cinemas.json").success(function(e){t.value=[],t.data=[];for(var o in e.data)t.value.push(e.data[o]);for(var o=0;o<t.value.length;o++)for(var i=0;i<t.value[o].length;i++)t.data.push(t.value[o][i])}),t.goCinemaDetail=function(t){o.go("cinema-detail",{cinemaId:t})},t.searchCont={},t.ItemArr2=[],t.search=function(){t.box=!1,t.ItemArr2=[];for(var e=0;e<t.data.length;e++)(t.data[e].nm.indexOf(t.searchCont.key)>=0||t.data[e].addr.indexOf(t.searchCont.key)>=0)&&t.ItemArr2.push(t.data[e]);""==t.ItemArr2&&(t.box=!0,t.ItemArr2=[])},t.goDetail=function(t){o.go("tab.film-detail",{id:t})},t.clearSearch=function(){alert(111),t.searchName="",console.log(t.searchName),t.ItemArr2=[]}}]);
app.directive("filmDate",function(){return{restrict:"AE",replace:!0,transclude:!0,template:"<p></p>",link:function(t,i,e){i.bind("click",function(){$(this).addClass("choose-date")&&$(this).siblings("p").removeClass("choose-date")})}}}).directive("expand",function(){return{restrict:"AE",replace:!0,transclude:!0,template:"<a>展开</a>",link:function(t,i,e){i.bind("click",function(){"展开"==$(this).text()?$(this).text("收起")&&$(this).parent().siblings("div").css("display","block"):"收起"==$(this).text()&&$(this).text("展开")&&$(this).parent().siblings("div").css("display","-webkit-box")})}}});