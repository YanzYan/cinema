var app=angular.module("starter",["ionic"]);app.run(["$ionicPlatform",function(o){o.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]);
app.config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(t,e,l){l.backButton.text("返回"),l.backButton.previousTitleText(!1),l.platform.android.tabs.position("bottom"),l.platform.android.navBar.alignTitle("center"),t.state("tab",{url:"/tab",abstract:!0,templateUrl:"templates/tabs.html"}).state("tab.film",{url:"/film",views:{"tab-film":{templateUrl:"templates/tab-film.html",controller:"FilmCtrl"}}}).state("tab.film-detail",{url:"/film-detail?id",views:{"tab-film":{templateUrl:"templates/film-detail.html",controller:"FilmDetailCtrl"}}}).state("tab.film-search",{url:"/film-search",views:{"tab-film":{templateUrl:"templates/film-search.html",controller:"FilmSearchCtrl"}}}).state("tab.cinema-search",{url:"/cinema-search",views:{"tab-cinema":{templateUrl:"templates/cinema-search.html",controller:"CinemaSearchCtrl"}}}).state("tab.cinema",{url:"/cinema",views:{"tab-cinema":{templateUrl:"templates/tab-cinema.html",controller:"CinemaCtrl"}}}).state("tab.film-list",{url:"/film-list?coming",views:{"tab-film":{templateUrl:"templates/film-list.html",controller:"FilmListCtrl"}}}).state("tab.mine",{url:"/mine",views:{"tab-mine":{templateUrl:"templates/tab-mine.html",controller:"MineCtrl"}}}).state("cinema-detail",{url:"/cinema-detail?cinemaId",templateUrl:"templates/cinema-detail.html",controller:"CinemaDetailCtrl"}).state("buy-ticket",{url:"/buy-ticket",templateUrl:"templates/buy-ticket.html",controller:"BuyTicketCtrl"}),e.otherwise("/tab/film")}]);
app.filter("to_trusted",["$sce",function(t){return function(r){return t.trustAsHtml(r)}}]);
app.controller("TabsCtrl",["$rootScope","$state",function(e,t){e.$on("$ionicView.beforeEnter",function(){e.hideTabs=!1,"tab.film"!=t.current.name&&"tab.cinema"!=t.current.name&&"tab.mine"!=t.current.name&&(e.hideTabs=!0)})}]).controller("FilmCtrl",["$scope","$state","$http","$ionicLoading",function(e,t,o,i){function n(){o.get("https://m.maoyan.com/movie/list.json?type=hot&offset=0&limit=3").success(function(t){e.hot=t.data.movies}),o.get("https://m.maoyan.com/movie/list.json?type=coming&offset=0&limit=4").success(function(t){e.coming=t.data.movies,i.hide()}).error(function(e){i.hide(),alert(e)}),o.get("https://m.maoyan.com/cinemas.json").success(function(t){e.data=t.data,e.value=[];for(var o in t.data)e.value.push(t.data[o]);e.selectedSite=e.value[0]})}function a(){$.getScript("http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=js",function(t){"1"==remote_ip_info.ret?e.addr=remote_ip_info.city:alert("没有找到匹配的IP地址信息！"),i.hide()})}!function(){i.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner>'}),n()}(),a(),e.getLocation=function(){a(),alert("您所在的区域是"+e.addr)},e.goFilmDetail=function(e){t.go("tab.film-detail",{id:e})},e.goFilmList=function(e){t.go("tab.film-list",{coming:e})},e.goCinemaDetail=function(e){t.go("cinema-detail",{cinemaId:e})},e.goFilmSearch=function(){t.go("tab.film-search")}}]).controller("CinemaCtrl",["$scope","$state","$ionicSlideBoxDelegate","$http",function(e,t,o,i){e.selectedSite=0,i.get("https://m.maoyan.com/cinemas.json").success(function(t){e.data=t.data,e.value=[];for(var o in t.data)e.value.push(t.data[o]);e.selectedSite=e.value[0]}),e.goCinemaDetail=function(e){t.go("cinema-detail",{cinemaId:e})}}]).controller("FilmDetailCtrl",["$scope","$http","$state","$ionicViewSwitcher","$stateParams","$ionicLoading","$sce",function(e,t,o,i,n,a,c){function s(){e.id=n.id,console.log(n.id),e.url="http://m.maoyan.com/movie/"+e.id+".json",t.get(e.url).success(function(t){e.filmData=t.data.MovieDetailModel,console.log(e.filmData.vd),a.hide()}).error(function(e){a.hide(),alert(e)})}e.goBuyTicket=function(e){o.go("buy-ticket",{id:e}),i.nextDirection("forwoard")},function(){a.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner>'}),s()}()}]).controller("BuyTicketCtrl",["$scope","$ionicViewSwitcher","$stateParams",function(e,t,o){t.nextDirection("forwoard"),e.id=o.id,console.log(e.id)}]).controller("CinemaDetailCtrl",["$rootScope","$scope","$state","$stateParams","$ionicSlideBoxDelegate","$http",function(e,t,o,i,n,a){e.updateSwiper=function(){mySwiper.update()},function(){t.cinemaId=i.cinemaId,console.log(t.cinemaId),t.url="https://m.maoyan.com/showtime/wrap.json?cinemaid="+t.cinemaId+"&movieid=",a.get(t.url).success(function(e){t.cinema=e.data,console.log(e)})}(),t.slideIndex=0,t.slideChanged=function(e){t.slideIndex=e,0==t.slideIndex?console.log("slide 0"):1==t.slideIndex?console.log("slide 1"):2==t.slideIndex?console.log("slide 2"):3==t.slideIndex&&console.log("slide 3")},t.activeSlide=function(e){n.slide(e)}}]).controller("FilmListCtrl",["$scope","$state","$ionicSlideBoxDelegate","$http","$stateParams","$ionicLoading",function(e,t,o,i,n,a){function c(){a.show({template:'<ion-spinner icon="lines" class="spinner-calm"></ion-spinner>'}),s()}function s(){i.get("https://m.maoyan.com/movie/list.json?type=hot&offset=0&limit=1000").success(function(t){e.hot=t.data.movies,a.hide()}).error(function(e){a.hide()}),i.get("https://m.maoyan.com/movie/list.json?type=coming&offset=0&limit=1000").success(function(t){e.coming=t.data.movies,a.hide()}).error(function(e){a.hide()})}e.$on("$ionicView.enter",function(e){c()}),void 0!=n.coming?(e.hotClass=!1,e.comingClass=!0):(e.hotClass=!0,e.comingClass=!1),e.activeSlide=function(t){o.slide(t),0==t?(e.hotClass=!0,e.comingClass=!1):1==t&&(e.hotClass=!1,e.comingClass=!0)},e.goDetail=function(e){t.go("tab.film-detail",{id:e})}}]).controller("MineCtrl",["$scope",function(e){}]).controller("FilmSearchCtrl",["$scope","$http","$state",function(e,t,o){e.hot=[],function(){t.get("https://m.maoyan.com/movie/list.json?type=hot&offset=0&limit=1000").success(function(t){e.hot=t.data.movies}),t.get("https://m.maoyan.com/movie/list.json?type=coming&offset=0&limit=1000").success(function(t){e.coming=t.data.movies,e.all=e.hot.concat(e.coming)})}(),e.searchCont={},e.ItemArr2=[],e.search=function(){e.box=!1,e.ItemArr2=[];for(var t=0;t<e.all.length;t++){var o=t;e.all[o].nm.indexOf(e.searchCont.key)>=0&&e.ItemArr2.push(e.all[o])}""==e.ItemArr2&&(e.box=!0,e.ItemArr2=[])},e.goDetail=function(e){o.go("tab.film-detail",{id:e})},e.clearSearch=function(){alert(111),e.searchName="",console.log(e.searchName),e.ItemArr2=[]}}]).controller("CinemaSearchCtrl",["$scope","$http","$state",function(e,t,o){t.get("https://m.maoyan.com/cinemas.json").success(function(t){e.value=[],e.data=[];for(var o in t.data)e.value.push(t.data[o]);for(var o=0;o<e.value.length;o++)for(var i=0;i<e.value[o].length;i++)e.data.push(e.value[o][i])}),e.goCinemaDetail=function(e){o.go("cinema-detail",{cinemaId:e})},e.searchCont={},e.ItemArr2=[],e.search=function(){e.box=!1,e.ItemArr2=[];for(var t=0;t<e.data.length;t++)(e.data[t].nm.indexOf(e.searchCont.key)>=0||e.data[t].addr.indexOf(e.searchCont.key)>=0)&&e.ItemArr2.push(e.data[t]);""==e.ItemArr2&&(e.box=!0,e.ItemArr2=[])},e.goDetail=function(e){o.go("tab.film-detail",{id:e})},e.clearSearch=function(){alert(111),e.searchName="",console.log(e.searchName),e.ItemArr2=[]}}]);
app.directive("filmDate",function(){return{restrict:"AE",replace:!0,transclude:!0,template:"<p></p>",link:function(e,i,t){i.bind("click",function(){$(this).addClass("choose-date")&&$(this).siblings("p").removeClass("choose-date")})}}}).directive("expand",function(){return{restrict:"AE",replace:!0,transclude:!0,template:"<a>展开</a>",link:function(e,i,t){i.bind("click",function(){"展开"==$(this).text()?$(this).text("收起")&&$(this).parent().siblings("div").css("display","block"):"收起"==$(this).text()&&$(this).text("展开")&&$(this).parent().siblings("div").css("display","-webkit-box")})}}}).directive("swiperDirective",["$rootScope",function(e){return{restrict:"A",controller:function(){this.ready=function(){mySwiper.update()}},link:function(e,i,t,n){mySwiper=new Swiper(".swiper-container",{loop:!1,pagination:".swiper-pagination",slidesPerView:4.2,centeredSlides:!0,onSlideChangeEnd:function(i){console.log(i.activeIndex),e.index=i.activeIndex}}),console.log(mySwiper)}}}]).directive("swiperSlide",[function(){return{restrict:"A",require:"^swiperDirective",link:function(e,i,t,n){e.$last&&n.ready()}}}]).run(["$rootScope",function(e){e.updateSwiper=function(){mySwiper.update()}}]);